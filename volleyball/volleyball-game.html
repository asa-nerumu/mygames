<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>青空スパイク！</title>
     <style>
      body { font-family: sans-serif; text-align: center; background: #f4f4f4; margin: 0; }
     .screen { display: none; padding: 2em; }
     .active { display: block; }
     button { margin: 1em; padding: 1em 2em; font-size: 1rem; }
     
           /* ホーム画面の背景画像 */
      #home {
        background: url('start.png') no-repeat center center;
        background-size: cover;
        height: 100vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      
      /* 画面遷移時の確実な非表示 */
      .screen:not(.active) {
        display: none !important;
      }
      
      #home .title-image-wrap {
        position: relative;
        display: inline-block;
        overflow: hidden;
        margin: 0;
        margin-top: -50px; /* 画像上の余白を50px詰める */
      }

      #home .title-image {
        width: auto;
        height: auto;
        max-width: none;
        max-height: none;
        display: block;
        margin: 0;
      }

      /* キラッと光るスイープ */
      #home .title-image-wrap::after {
        content: "";
        position: absolute;
        top: -30%;
        left: -120%;
        width: 80px; /* 光の幅 */
        height: 160%;
        background: linear-gradient(90deg,
          rgba(255,255,255,0) 0%,
          rgba(255,255,255,0.85) 50%,
          rgba(255,255,255,0) 100%);
        transform: rotate(20deg);
        filter: blur(0.5px);
        animation: shineSweep 2.8s ease-in-out infinite;
        pointer-events: none;
      }
      
           #home button {
        background: #FFD700;
        border: none;
        color: #333;
        font-weight: bold;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        transition: transform 0.2s;
        border-radius: 10px;
        margin: 8px 0 0; /* 画像のすぐ下に配置 */
      }
     
     #home button:hover {
       transform: scale(1.05);
     }
      
      /* 共通レイアウト（左右並び→小画面で縦並び） */
      .layout {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 20px;
        margin: 20px 0;
      }
      .training-layout .status-col,
      .training-layout .image-col,
      .match-layout .content-col,
      .match-layout .image-col { flex: 1; }

      /* 小画面時の縦並び順序（タイトル→画像→ステータス/ログ→ボタン） */
      @media (max-width: 768px) {
        .layout { flex-direction: column; align-items: center; }
        #training .image-col { order: 1; width: 100%; text-align: center; }
        #training .status-col { order: 2; width: 100%; }
        #training .actions-block { text-align: center; }

        #match .image-col { order: 1; width: 100%; text-align: center; }
        #match .content-col { order: 2; width: 100%; text-align: center; }
        #matchLog { width: 90%; max-width: 420px; }

        #ending .image-col { order: 1; width: 100%; text-align: center; }
        #ending .content-col { order: 2; width: 100%; text-align: center; }
      }

      /* 育成画面/試合画面タイトル（下の項目と同テイストの3D・青系） */
      #training > h2,
      #match > h2 {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        margin: 0 auto 20px; /* 中央寄せ */
        padding: 10px 16px;
        background: linear-gradient(to bottom, #DDF0FF 0%, #8AC7FF 50%, #3BA0FF 100%);
        color: #0B3A6E; /* ステータス項目と同じ文字色 */
        text-shadow: 0 1px 0 rgba(255,255,255,0.85);
        border: 1px solid #2B7ACC;
        border-bottom-color: #1E5FA0;
        border-radius: 12px;
        font-weight: 800;
        font-size: 1.8rem;
        line-height: 1.25;
        letter-spacing: 0.02em;
        box-shadow:
          inset 0 1px 0 rgba(255,255,255,0.9),
          inset 0 -2px 0 rgba(0,0,0,0.04),
          0 6px 0 #2B7ACC,
          0 8px 16px rgba(0,0,0,0.22);
      }

      #training > h2::after,
      #match > h2::after { content: none; }

      /* 試合画面タイトル（ログ/ボタンと同じ黄色系） */
      #match > h2 {
        background: linear-gradient(to bottom, #FFF3A0 0%, #FFD24D 50%, #FFB300 100%);
        color: #5A4100;
        text-shadow: 0 1px 0 rgba(255,255,255,0.7);
        border: 1px solid #D19500;
        border-bottom-color: #9C6E00;
        box-shadow:
          inset 0 1px 0 rgba(255,255,255,0.9),
          inset 0 -2px 0 rgba(0,0,0,0.06),
          0 6px 0 #C58A00,
          0 8px 16px rgba(0,0,0,0.25);
      }

      /* 育成画面ボタン / 試合画面ボタン（立体感・共通） */
      #training button,
      #match #matchNextBtn {
        background: linear-gradient(to bottom, #FFF3A0 0%, #FFD24D 50%, #FFB300 100%);
        color: #5A4100;
        text-shadow: 0 1px 0 rgba(255,255,255,0.7);
        border: 1px solid #D19500;
        border-bottom-color: #9C6E00;
        border-radius: 12px;
        padding: 12px 24px;
        font-weight: 700;
        box-shadow:
          inset 0 1px 0 rgba(255,255,255,0.9),
          inset 0 -2px 0 rgba(0,0,0,0.06),
          0 6px 0 #C58A00,
          0 8px 16px rgba(0,0,0,0.25);
        transform: translateY(0);
        transition: transform 0.1s ease, box-shadow 0.1s ease, filter 0.2s ease;
      }

      #training button:hover,
      #match #matchNextBtn:hover,
      #restartBtn:hover {
        filter: brightness(1.05);
      }

      #training button:active,
      #match #matchNextBtn:active,
      #restartBtn:active {
        transform: translateY(3px);
        box-shadow:
          inset 0 1px 0 rgba(255,255,255,0.9),
          inset 0 -1px 0 rgba(0,0,0,0.06),
          0 3px 0 #C58A00,
          0 4px 8px rgba(0,0,0,0.2);
      }

      /* 育成画面ステータス（ボタンと同じ3Dデザイン） */
      #training .status-list {
        list-style: none;
        padding: 0;
        margin: 0 auto 16px; /* 左右中央寄せ */
        display: grid;
        gap: 12px;
        justify-content: center; /* 子要素を中央に */
        justify-items: center;
        align-items: center;
      }

      #training .status-item {
        background: linear-gradient(to bottom, #DDF0FF 0%, #8AC7FF 50%, #3BA0FF 100%);
        color: #0B3A6E;
        text-shadow: 0 1px 0 rgba(255,255,255,0.85);
        border: 1px solid #2B7ACC;
        border-bottom-color: #1E5FA0;
        border-radius: 12px;
        padding: 10px 14px;
        font-weight: 700;
        box-shadow:
          inset 0 1px 0 rgba(255,255,255,0.9),
          inset 0 -2px 0 rgba(0,0,0,0.04),
          0 6px 0 #2B7ACC,
          0 8px 16px rgba(0,0,0,0.22);
        display: inline-flex;
        align-items: baseline;
        justify-content: flex-start;
        gap: 8px;
        width: fit-content;
        max-width: 100%;
        white-space: nowrap;
      }

      #training .status-item .label { font-weight: 700; }
      #training .status-item .value { font-weight: 800; }
    #matchLog {
      background: linear-gradient(to bottom, #FFF3A0 0%, #FFD24D 50%, #FFB300 100%);
      color: #5A4100;
      text-shadow: 0 1px 0 rgba(255,255,255,0.6);
      border: 1px solid #D19500;
      border-bottom-color: #9C6E00;
      border-radius: 12px;
      padding: 12px;
      height: 120px;
      overflow-y: auto;
      margin: 10px auto;
      width: 300px;
      text-align: left;
      white-space: pre-wrap;
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.9),
        inset 0 -2px 0 rgba(0,0,0,0.06),
        0 6px 0 #C58A00,
        0 8px 16px rgba(0,0,0,0.15);
    }
    
    /* 震えるエフェクト */
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }
      20%, 40%, 60%, 80% { transform: translateX(2px); }
    }
    
    /* タイトル画像のキラッと光るエフェクト */
    @keyframes shineSweep {
      0% { left: -120%; }
      20% { left: -120%; }
      60% { left: 120%; }
      100% { left: 120%; }
    }

    .shake {
      animation: shake 0.5s ease-in-out;
    }
    
    /* 勝利時の震えるエフェクト（より激しく） */
    @keyframes victoryShake {
      0%, 100% { transform: translateX(0) scale(1); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px) scale(1.1); }
      20%, 40%, 60%, 80% { transform: translateX(5px) scale(1.1); }
    }
    
    .victory-shake {
      animation: victoryShake 1s ease-in-out;
      display: inline-block;
    }
    
    /* 敗北時の震えるエフェクト（よりゆっくり） */
    @keyframes defeatShake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }
      20%, 40%, 60%, 80% { transform: translateX(2px); }
    }
    
    .defeat-shake {
      animation: defeatShake 1.2s ease-in-out;
      display: inline-block;
    }

    /* 花びらエフェクト */
    .confetti-container {
      position: relative;
      display: inline-block;
      overflow: visible;
    }

    .confetti {
      position: absolute;
      width: 14px;
      height: 14px;
      background: linear-gradient(45deg, #FFD700, #FFA500, #FFD700, #FFA500, #FFD700);
      border-radius: 3px;
      animation: petal-fall 4s ease-in-out infinite;
      box-shadow: 0 0 6px rgba(255, 215, 0, 0.8);
      z-index: 1000;
      pointer-events: none;
    }
    
    /* 紙吹雪の色のバリエーション */
    .confetti-1, .confetti-3, .confetti-5, .confetti-7, .confetti-9 {
      background: linear-gradient(45deg, #FFD700, #FFA500, #FFD700, #FFA500, #FFD700);
    }
    
    .confetti-2, .confetti-4, .confetti-6, .confetti-8, .confetti-10 {
      background: linear-gradient(45deg, #FFA500, #FFD700, #FFA500, #FFD700, #FFA500);
    }

    .confetti-1 { 
      left: 10%; 
      top: -20px;
      animation-delay: 0s; 
      animation-duration: 4.2s;
      transform: rotate(45deg);
    }
    .confetti-2 { 
      left: 20%; 
      top: -20px;
      animation-delay: 0.8s; 
      animation-duration: 3.8s;
      transform: rotate(135deg);
    }
    .confetti-3 { 
      left: 30%; 
      top: -20px;
      animation-delay: 1.6s; 
      animation-duration: 4.5s;
      transform: rotate(225deg);
    }
    .confetti-4 { 
      left: 40%; 
      top: -20px;
      animation-delay: 2.4s; 
      animation-duration: 3.9s;
      transform: rotate(315deg);
    }
    .confetti-5 { 
      left: 50%; 
      top: -20px;
      animation-delay: 3.2s; 
      animation-duration: 4.1s;
      transform: rotate(45deg);
    }
    .confetti-6 { 
      left: 60%; 
      top: -20px;
      animation-delay: 0.4s; 
      animation-duration: 4.3s;
      transform: rotate(135deg);
    }
    .confetti-7 { 
      left: 70%; 
      top: -20px;
      animation-delay: 1.2s; 
      animation-duration: 3.7s;
      transform: rotate(225deg);
    }
    .confetti-8 { 
      left: 80%; 
      top: -20px;
      animation-delay: 2.0s; 
      animation-duration: 4.4s;
      transform: rotate(315deg);
    }
    .confetti-9 { 
      left: 15%; 
      top: -20px;
      animation-delay: 2.8s; 
      animation-duration: 3.6s;
      transform: rotate(45deg);
    }
    .confetti-10 { 
      left: 85%; 
      top: -20px;
      animation-delay: 3.6s; 
      animation-duration: 4.0s;
      transform: rotate(135deg);
    }

    @keyframes petal-fall {
      0% {
        transform: translateY(0px) translateX(0px) rotate(0deg);
        opacity: 1;
      }
      25% {
        transform: translateY(60px) translateX(15px) rotate(90deg);
        opacity: 0.9;
      }
      50% {
        transform: translateY(120px) translateX(-10px) rotate(180deg);
        opacity: 0.8;
      }
      75% {
        transform: translateY(180px) translateX(20px) rotate(270deg);
        opacity: 0.6;
      }
      100% {
        transform: translateY(240px) translateX(-15px) rotate(360deg);
        opacity: 0;
      }
    }

    /* 名前入力モーダル */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal-overlay.active { display: flex; }
    .modal-dialog {
      background: #ffffff;
      border-radius: 12px;
      padding: 20px;
      width: 90%;
      max-width: 360px;
      box-shadow: 0 10px 24px rgba(0,0,0,0.25);
      text-align: left;
    }
    .modal-dialog h3 { margin: 0 0 12px; color: #333; }
    .modal-dialog input[type="text"] {
      width: 100%;
      padding: 10px 12px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      outline: none;
      box-sizing: border-box;
    }
    .modal-actions { display: flex; gap: 12px; justify-content: flex-end; margin-top: 14px; }
    .modal-actions .primary {
      background: linear-gradient(to bottom, #FFF3A0 0%, #FFD24D 50%, #FFB300 100%);
      color: #5A4100;
      text-shadow: 0 1px 0 rgba(255,255,255,0.7);
      border: 1px solid #D19500;
      border-bottom-color: #9C6E00;
      border-radius: 10px;
      padding: 10px 18px;
      font-weight: 700;
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.9),
        inset 0 -2px 0 rgba(0,0,0,0.06),
        0 6px 0 #C58A00,
        0 8px 16px rgba(0,0,0,0.15);
    }
    .modal-actions .secondary {
      background: #e9e9e9;
      color: #333;
      border: 1px solid #cfcfcf;
      border-radius: 10px;
      padding: 10px 18px;
      font-weight: 700;
    }
  </style>
</head>
<body>

  <!-- ホーム画面 -->
  <div id="home" class="screen active">
    <div class="title-image-wrap">
      <img src="titleimage-02.png" alt="バレーボール選手育成ゲーム" class="title-image" />
    </div>
    <button onclick="openNameModal()">スタート</button>
  </div>

  <!-- 名前入力モーダル -->
  <div id="nameModal" class="modal-overlay" aria-hidden="true">
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="nameModalTitle">
      <h3 id="nameModalTitle">名前を入力してください</h3>
      <input id="nameInput" type="text" maxlength="20" placeholder="たかし" />
      <div class="modal-actions">
        <button type="button" class="secondary" onclick="closeNameModal()">キャンセル</button>
        <button type="button" class="primary" onclick="confirmName()">OK</button>
      </div>
    </div>
  </div>

  <!-- 育成画面 -->
  <div id="training" class="screen">
    <h2>育成画面</h2>
    <div class="layout training-layout">
      <div class="status-col">
        <div class="status-block">
          <ul class="status-list">
            <li class="status-item"><span class="label">名前</span><span class="value" id="playerName">たかし</span></li>
            <li class="status-item" id="powerContainer"><span class="label">筋力</span><span class="value" id="power">10</span></li>
            <li class="status-item" id="techContainer"><span class="label">テクニック</span><span class="value" id="tech">10</span></li>
            <li class="status-item"><span class="label">第</span><span class="value" id="week">1</span><span class="label">週目</span></li>
          </ul>
        </div>
        <div class="actions-block">
          <button onclick="train('power')">筋トレする</button>
          <button onclick="train('tech')">技術練習する</button>
          <br />
          <button onclick="nextWeek()">次の週へ</button>
        </div>
      </div>
      <div class="image-col">
        <img src="rensyuu.png" alt="練習場" style="max-width: 100%; height: auto; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);" />
      </div>
    </div>
  </div>

  <!-- 試合イベント画面 -->
  <div id="match" class="screen">
    <h2 id="matchTitle">試合イベント</h2>
    <div class="layout match-layout">
      <div class="content-col">
        <div id="matchLog"></div>
        <button id="matchNextBtn" onclick="playMatchStep()" disabled>試合開始</button>
      </div>
      <div class="image-col">
        <img src="game.png" alt="試合場" style="max-width: 100%; height: auto; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);" />
      </div>
    </div>
  </div>

    <!-- エンディング画面 -->
  <div id="ending" class="screen">
    <h2 style="
      background: linear-gradient(to bottom, #FFF3A0 0%, #FFD24D 50%, #FFB300 100%);
      color: #5A4100;
      text-shadow: 0 1px 0 rgba(255,255,255,0.7);
      border: 1px solid #D19500;
      border-bottom-color: #9C6E00;
      border-radius: 12px;
      padding: 10px 16px;
      font-weight: 700;
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.9),
        inset 0 -2px 0 rgba(0,0,0,0.06),
        0 6px 0 #C58A00,
        0 8px 16px rgba(0,0,0,0.25);
      margin: 0 auto 20px;
      text-align: center;
      display: inline-block;
    ">🏆 全国大会優勝！🏆</h2>
    <div class="layout match-layout">
      <div class="content-col">
        <div class="status-block">
          <div style="
            background: linear-gradient(to bottom, #FFF3A0 0%, #FFD24D 50%, #FFB300 100%);
            color: #5A4100;
            text-shadow: 0 1px 0 rgba(255,255,255,0.7);
            border: 1px solid #D19500;
            border-bottom-color: #9C6E00;
            border-radius: 12px;
            padding: 16px 20px;
            font-weight: 700;
            box-shadow:
              inset 0 1px 0 rgba(255,255,255,0.9),
              inset 0 -2px 0 rgba(0,0,0,0.06),
              0 6px 0 #C58A00,
              0 8px 16px rgba(0,0,0,0.25);
            margin: 0 auto 20px;
            text-align: center;
            display: inline-block;
          ">
            <h3 style="margin: 0 0 12px 0; font-size: 1.3rem;">表彰式</h3>
            <p style="margin: 8px 0; font-size: 1.1rem;">おめでとうございます！</p>
            <p style="margin: 8px 0; font-size: 1.1rem;">あなたは全国大会を制覇し、</p>
            <p style="margin: 8px 0; font-size: 1.1rem;">バレーボール界の頂点に立ちました！</p>
          </div>
          <br />
          <div class="status-list" style="margin: 20px auto;">
            <div class="status-item" style="
              background: linear-gradient(to bottom, #FFF3A0 0%, #FFD24D 50%, #FFB300 100%);
              color: #5A4100;
              text-shadow: 0 1px 0 rgba(255,255,255,0.7);
              border: 1px solid #D19500;
              border-bottom-color: #9C6E00;
              border-radius: 12px;
              padding: 12px 18px;
              font-weight: 700;
              box-shadow:
                inset 0 1px 0 rgba(255,255,255,0.9),
                inset 0 -2px 0 rgba(0,0,0,0.06),
                0 6px 0 #C58A00,
                0 8px 16px rgba(0,0,0,0.22);
              margin: 8px 0;
              display: inline-flex;
              align-items: baseline;
              gap: 8px;
            ">
              <span class="label">筋力</span>
              <span class="value" id="finalPower">0</span>
            </div>
            <div class="status-item" style="
              background: linear-gradient(to bottom, #FFF3A0 0%, #FFD24D 50%, #FFB300 100%);
              color: #5A4100;
              text-shadow: 0 1px 0 rgba(255,255,255,0.7);
              border: 1px solid #D19500;
              border-bottom-color: #9C6E00;
              border-radius: 12px;
              padding: 12px 18px;
              font-weight: 700;
              box-shadow:
                inset 0 1px 0 rgba(255,255,255,0.9),
                inset 0 -2px 0 rgba(0,0,0,0.06),
                0 6px 0 #C58A00,
                0 8px 16px rgba(0,0,0,0.22);
              margin: 8px 0;
              display: inline-flex;
              align-items: baseline;
              gap: 8px;
            ">
              <span class="label">テクニック</span>
              <span class="value" id="finalTech">0</span>
            </div>
            <div class="status-item" style="
              background: linear-gradient(to bottom, #FFF3A0 0%, #FFD24D 50%, #FFB300 100%);
              color: #5A4100;
              text-shadow: 0 1px 0 rgba(255,255,255,0.7);
              border: 1px solid #D19500;
              border-bottom-color: #9C6E00;
              border-radius: 12px;
              padding: 12px 18px;
              font-weight: 700;
              box-shadow:
                inset 0 1px 0 rgba(255,255,255,0.9),
                inset 0 -2px 0 rgba(0,0,0,0.06),
                0 6px 0 #C58A00,
                0 8px 16px rgba(0,0,0,0.22);
              margin: 8px 0;
              display: inline-flex;
              align-items: baseline;
              gap: 8px;
            ">
              <span class="label">総合能力</span>
              <span class="value" id="finalTotal">0</span>
            </div>
          </div>
          <br />
          <button onclick="restartGame()" id="restartBtn" style="
            background: linear-gradient(to bottom, #FFF3A0 0%, #FFD24D 50%, #FFB300 100%);
            color: #5A4100;
            text-shadow: 0 1px 0 rgba(255,255,255,0.7);
            border: 1px solid #D19500;
            border-bottom-color: #9C6E00;
            border-radius: 12px;
            padding: 12px 24px;
            font-weight: 700;
            box-shadow:
              inset 0 1px 0 rgba(255,255,255,0.9),
              inset 0 -2px 0 rgba(0,0,0,0.06),
              0 6px 0 #C58A00,
              0 8px 16px rgba(0,0,0,0.25);
            transform: translateY(0);
            transition: transform 0.1s ease, box-shadow 0.1s ease, filter 0.2s ease;
            margin: 20px 0;
            cursor: pointer;
          ">もう一度プレイ</button>
        </div>
      </div>
      <div class="image-col">
        <div class="confetti-container">
          <img src="ending.png" alt="エンディング" style="max-width: 100%; height: auto; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);" />
          <!-- 紙吹雪の要素を画像の上に重ねて配置 -->
          <div class="confetti confetti-1"></div>
          <div class="confetti confetti-2"></div>
          <div class="confetti confetti-3"></div>
          <div class="confetti confetti-4"></div>
          <div class="confetti confetti-5"></div>
          <div class="confetti confetti-6"></div>
          <div class="confetti confetti-7"></div>
          <div class="confetti confetti-8"></div>
          <div class="confetti confetti-9"></div>
          <div class="confetti confetti-10"></div>
        </div>
      </div>
    </div>
  </div>

<script>
  // ページアクセス時は常に最上部を表示
  if ('scrollRestoration' in window.history) {
    window.history.scrollRestoration = 'manual';
  }
  const forceScrollToTop = () => {
    window.scrollTo(0, 0);
  };
  document.addEventListener('DOMContentLoaded', forceScrollToTop);
  window.addEventListener('load', forceScrollToTop);
  window.addEventListener('pageshow', (event) => {
    if (event.persisted) forceScrollToTop();
  });

  // プレイヤーデータ
  let player = {
    name: "たかし",
    power: 10,
    tech: 10,
    week: 1
  };

  // 大会データ
  let tournament = {
    stage: 0, // 0: 大会未開始, 1~7: 試合ステージ
    maxStage: 7,
    active: false,
  };

  // 試合ログ候補
  const matchLogs = [
    "スパイクを決めた！",
    "サーブを決めた！",
    "レシーブを打ち返した！",
    "トスがきれいに上がった！",
    "フェイントが決まった！",
    "ブロックで得点！"
  ];

  // 試合ログの表示間隔（ミリ秒）
  const MATCH_LOG_DELAY_MS = 1200;

  // ログ表示用キューとインデックス
  let logQueue = [];
  let currentLogIndex = 0;
  let matchResult = null;

  function startGame() {
    switchScreen("home", "training");
    updateStatus();
  }

  // 名前入力モーダル
  function openNameModal() {
    const overlay = document.getElementById('nameModal');
    overlay.classList.add('active');
    const input = document.getElementById('nameInput');
    input.value = player.name || '';
    setTimeout(() => input.focus(), 0);
  }

  function closeNameModal() {
    const overlay = document.getElementById('nameModal');
    overlay.classList.remove('active');
  }

  function confirmName() {
    const value = document.getElementById('nameInput').value.trim();
    if (value) {
      player.name = value;
      const nameSpan = document.getElementById('playerName');
      if (nameSpan) nameSpan.textContent = player.name;
    }
    closeNameModal();
    startGame();
  }

  function switchScreen(from, to) {
    document.getElementById(from).classList.remove("active");
    document.getElementById(to).classList.add("active");
    if (to === "home") {
      forceScrollToTop();
    }
  }

  function updateStatus() {
    document.getElementById("power").textContent = player.power;
    document.getElementById("tech").textContent = player.tech;
    document.getElementById("week").textContent = player.week;
  }

  function train(type) {
    player[type] += 1;
    updateStatus();
    
    // 震えるエフェクトを追加
    const containerId = type === 'power' ? 'powerContainer' : 'techContainer';
    const container = document.getElementById(containerId);
    container.classList.add('shake');
    
    // エフェクト終了後にクラスを削除
    setTimeout(() => {
      container.classList.remove('shake');
    }, 500);
  }

  function nextWeek() {
    player.week++;
    if (!checkForMatch()) {
      alert(`第${player.week}週目へ進みます`);
    }
  }

  // 大会開始判定と大会中なら試合表示
  function checkForMatch() {
    const total = player.power + player.tech;
    if (total >= 30 && tournament.stage === 0) {
      tournament.stage = 1;
      tournament.active = true;
      showMatch();
      return true;
    }
    if (tournament.active && tournament.stage > 0 && tournament.stage <= tournament.maxStage) {
      showMatch();
      return true;
    }
    return false;
  }

  function showMatch() {
    const titles = [
      "",
      "地方大会・予選",
      "地方大会・準決勝",
      "地方大会・決勝",
      "全国大会出場決定！",
      "全国大会・予選",
      "全国大会・準決勝",
      "全国大会・決勝",
    ];
    document.getElementById("matchTitle").textContent = titles[tournament.stage];
    document.getElementById("matchLog").textContent = "";
    document.getElementById("matchNextBtn").disabled = false;
    
    // ログ表示の状態をリセット
    currentLogIndex = 0;
    logQueue = [];
    matchResult = null;
    
    switchScreen("training", "match");
  }

  function prepareMatchLogs() {
    const shuffled = [...matchLogs].sort(() => 0.5 - Math.random());
    logQueue = shuffled.slice(0, 3);
    currentLogIndex = 0;

    // 勝率を1/2（50%）に固定
    const result = Math.random();
    matchResult = result <= 0.5;
  }

  function playMatchStep() {
    // 試合開始を押したらログ→結果の順で自動再生
    if (currentLogIndex === 0) {
      prepareMatchLogs();
      // ログエリアをクリア
      const logArea = document.getElementById("matchLog");
      logArea.textContent = "";
    }
    
    const logArea = document.getElementById("matchLog");
    const nextBtn = document.getElementById("matchNextBtn");
    nextBtn.disabled = true;

    const showNext = () => {
      if (currentLogIndex < logQueue.length) {
        const logSpan = document.createElement('span');
        logSpan.textContent = logQueue[currentLogIndex] + "\n";
        logArea.appendChild(logSpan);
        logArea.scrollTop = logArea.scrollHeight;
        currentLogIndex++;
        setTimeout(showNext, MATCH_LOG_DELAY_MS); // ログを順に表示
        return;
      }

      // ログをすべて表示した後に結果を表示（少し遅延を入れて確実に表示）
      setTimeout(() => {
        if (matchResult) {
          const winMessage = "\n勝利！ステージを進めます！";
          const winSpan = document.createElement('span');
          winSpan.style.color = 'red';
          winSpan.style.fontWeight = 'bold';
          winSpan.style.display = 'inline-block';
          winSpan.textContent = winMessage;
          logArea.appendChild(winSpan);
          setTimeout(() => { winSpan.classList.add('victory-shake'); }, 10);

          player.power += 2;
          player.tech += 2;
          tournament.stage++;
          if (tournament.stage > tournament.maxStage) {
            const endingMessage = "\n全国大会を制覇しました！表彰式へ！";
            const endingSpan = document.createElement('span');
            endingSpan.style.color = 'red';
            endingSpan.style.fontWeight = 'bold';
            endingSpan.style.display = 'inline-block';
            endingSpan.textContent = endingMessage;
            logArea.appendChild(endingSpan);
            setTimeout(() => { endingSpan.classList.add('victory-shake'); }, 10);
            tournament.active = false;
            setTimeout(() => { showEnding(); }, 3000);
          }
        } else {
          const loseMessage = "\n敗北…地方大会からやり直しです。";
          const loseSpan = document.createElement('span');
          loseSpan.style.color = 'blue';
          loseSpan.style.fontWeight = 'bold';
          loseSpan.style.display = 'inline-block';
          loseSpan.textContent = loseMessage;
          logArea.appendChild(loseSpan);
          setTimeout(() => { loseSpan.classList.add('defeat-shake'); }, 10);
          tournament.stage = 1;
          tournament.active = true;
        }

        updateStatus();
        setTimeout(() => { switchScreen("match", "training"); }, 2000);
      }, 500); // ログ表示完了後、500ms待ってから結果を表示
    };

    showNext();
  }

  function showEnding() {
    // 最終成績を表示
    document.getElementById("finalPower").textContent = player.power;
    document.getElementById("finalTech").textContent = player.tech;
    document.getElementById("finalTotal").textContent = player.power + player.tech;
    
    // エンディング画面に遷移
    switchScreen("match", "ending");
  }

  function restartGame() {
    // ゲームデータをリセット
    player = {
      name: "たかし",
      power: 10,
      tech: 10,
      week: 1
    };
    
    tournament = {
      stage: 0,
      maxStage: 7,
      active: false,
    };
    
    // ホーム画面に戻る
    switchScreen("ending", "home");
  }


</script>

</body>
</html>
