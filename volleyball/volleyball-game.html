<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>é’ç©ºã‚¹ãƒ‘ã‚¤ã‚¯ï¼</title>
     <style>
      body { font-family: sans-serif; text-align: center; background: #f4f4f4; margin: 0; }
     .screen { display: none; padding: 2em; }
     .active { display: block; }
     button { margin: 1em; padding: 1em 2em; font-size: 1rem; }
     
           /* ãƒ›ãƒ¼ãƒ ç”»é¢ã®èƒŒæ™¯ç”»åƒ */
      #home {
        background: url('start.png') no-repeat center center;
        background-size: cover;
        height: 100vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      
      /* ç”»é¢é·ç§»æ™‚ã®ç¢ºå®Ÿãªéè¡¨ç¤º */
      .screen:not(.active) {
        display: none !important;
      }
      
      #home .title-image-wrap {
        position: relative;
        display: inline-block;
        overflow: hidden;
        margin: 0;
        margin-top: -50px; /* ç”»åƒä¸Šã®ä½™ç™½ã‚’50pxè©°ã‚ã‚‹ */
      }

      #home .title-image {
        width: auto;
        height: auto;
        max-width: none;
        max-height: none;
        display: block;
        margin: 0;
      }

      /* ã‚­ãƒ©ãƒƒã¨å…‰ã‚‹ã‚¹ã‚¤ãƒ¼ãƒ— */
      #home .title-image-wrap::after {
        content: "";
        position: absolute;
        top: -30%;
        left: -120%;
        width: 80px; /* å…‰ã®å¹… */
        height: 160%;
        background: linear-gradient(90deg,
          rgba(255,255,255,0) 0%,
          rgba(255,255,255,0.85) 50%,
          rgba(255,255,255,0) 100%);
        transform: rotate(20deg);
        filter: blur(0.5px);
        animation: shineSweep 2.8s ease-in-out infinite;
        pointer-events: none;
      }
      
           #home button {
        background: #FFD700;
        border: none;
        color: #333;
        font-weight: bold;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        transition: transform 0.2s;
        border-radius: 10px;
        margin: 8px 0 0; /* ç”»åƒã®ã™ãä¸‹ã«é…ç½® */
      }
     
     #home button:hover {
       transform: scale(1.05);
     }
      
      /* å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆå·¦å³ä¸¦ã³â†’å°ç”»é¢ã§ç¸¦ä¸¦ã³ï¼‰ */
      .layout {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 20px;
        margin: 20px 0;
      }
      .training-layout .status-col,
      .training-layout .image-col,
      .match-layout .content-col,
      .match-layout .image-col { flex: 1; }

      /* å°ç”»é¢æ™‚ã®ç¸¦ä¸¦ã³é †åºï¼ˆã‚¿ã‚¤ãƒˆãƒ«â†’ç”»åƒâ†’ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹/ãƒ­ã‚°â†’ãƒœã‚¿ãƒ³ï¼‰ */
      @media (max-width: 768px) {
        .layout { flex-direction: column; align-items: center; }
        #training .image-col { order: 1; width: 100%; text-align: center; }
        #training .status-col { order: 2; width: 100%; }
        #training .actions-block { text-align: center; }

        #match .image-col { order: 1; width: 100%; text-align: center; }
        #match .content-col { order: 2; width: 100%; text-align: center; }
        #matchLog { width: 90%; max-width: 420px; }

        #ending .image-col { order: 1; width: 100%; text-align: center; }
        #ending .content-col { order: 2; width: 100%; text-align: center; }
      }

      /* è‚²æˆç”»é¢/è©¦åˆç”»é¢ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆä¸‹ã®é …ç›®ã¨åŒãƒ†ã‚¤ã‚¹ãƒˆã®3Dãƒ»é’ç³»ï¼‰ */
      #training > h2,
      #match > h2 {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        margin: 0 auto 20px; /* ä¸­å¤®å¯„ã› */
        padding: 10px 16px;
        background: linear-gradient(to bottom, #DDF0FF 0%, #8AC7FF 50%, #3BA0FF 100%);
        color: #0B3A6E; /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é …ç›®ã¨åŒã˜æ–‡å­—è‰² */
        text-shadow: 0 1px 0 rgba(255,255,255,0.85);
        border: 1px solid #2B7ACC;
        border-bottom-color: #1E5FA0;
        border-radius: 12px;
        font-weight: 800;
        font-size: 1.8rem;
        line-height: 1.25;
        letter-spacing: 0.02em;
        box-shadow:
          inset 0 1px 0 rgba(255,255,255,0.9),
          inset 0 -2px 0 rgba(0,0,0,0.04),
          0 6px 0 #2B7ACC,
          0 8px 16px rgba(0,0,0,0.22);
      }

      #training > h2::after,
      #match > h2::after { content: none; }

      /* è©¦åˆç”»é¢ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆãƒ­ã‚°/ãƒœã‚¿ãƒ³ã¨åŒã˜é»„è‰²ç³»ï¼‰ */
      #match > h2 {
        background: linear-gradient(to bottom, #FFF3A0 0%, #FFD24D 50%, #FFB300 100%);
        color: #5A4100;
        text-shadow: 0 1px 0 rgba(255,255,255,0.7);
        border: 1px solid #D19500;
        border-bottom-color: #9C6E00;
        box-shadow:
          inset 0 1px 0 rgba(255,255,255,0.9),
          inset 0 -2px 0 rgba(0,0,0,0.06),
          0 6px 0 #C58A00,
          0 8px 16px rgba(0,0,0,0.25);
      }

      /* è‚²æˆç”»é¢ãƒœã‚¿ãƒ³ / è©¦åˆç”»é¢ãƒœã‚¿ãƒ³ï¼ˆç«‹ä½“æ„Ÿãƒ»å…±é€šï¼‰ */
      #training button,
      #match #matchNextBtn {
        background: linear-gradient(to bottom, #FFF3A0 0%, #FFD24D 50%, #FFB300 100%);
        color: #5A4100;
        text-shadow: 0 1px 0 rgba(255,255,255,0.7);
        border: 1px solid #D19500;
        border-bottom-color: #9C6E00;
        border-radius: 12px;
        padding: 12px 24px;
        font-weight: 700;
        box-shadow:
          inset 0 1px 0 rgba(255,255,255,0.9),
          inset 0 -2px 0 rgba(0,0,0,0.06),
          0 6px 0 #C58A00,
          0 8px 16px rgba(0,0,0,0.25);
        transform: translateY(0);
        transition: transform 0.1s ease, box-shadow 0.1s ease, filter 0.2s ease;
      }

      #training button:hover,
      #match #matchNextBtn:hover,
      #restartBtn:hover {
        filter: brightness(1.05);
      }

      #training button:active,
      #match #matchNextBtn:active,
      #restartBtn:active {
        transform: translateY(3px);
        box-shadow:
          inset 0 1px 0 rgba(255,255,255,0.9),
          inset 0 -1px 0 rgba(0,0,0,0.06),
          0 3px 0 #C58A00,
          0 4px 8px rgba(0,0,0,0.2);
      }

      /* è‚²æˆç”»é¢ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆãƒœã‚¿ãƒ³ã¨åŒã˜3Dãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰ */
      #training .status-list {
        list-style: none;
        padding: 0;
        margin: 0 auto 16px; /* å·¦å³ä¸­å¤®å¯„ã› */
        display: grid;
        gap: 12px;
        justify-content: center; /* å­è¦ç´ ã‚’ä¸­å¤®ã« */
        justify-items: center;
        align-items: center;
      }

      #training .status-item {
        background: linear-gradient(to bottom, #DDF0FF 0%, #8AC7FF 50%, #3BA0FF 100%);
        color: #0B3A6E;
        text-shadow: 0 1px 0 rgba(255,255,255,0.85);
        border: 1px solid #2B7ACC;
        border-bottom-color: #1E5FA0;
        border-radius: 12px;
        padding: 10px 14px;
        font-weight: 700;
        box-shadow:
          inset 0 1px 0 rgba(255,255,255,0.9),
          inset 0 -2px 0 rgba(0,0,0,0.04),
          0 6px 0 #2B7ACC,
          0 8px 16px rgba(0,0,0,0.22);
        display: inline-flex;
        align-items: baseline;
        justify-content: flex-start;
        gap: 8px;
        width: fit-content;
        max-width: 100%;
        white-space: nowrap;
      }

      #training .status-item .label { font-weight: 700; }
      #training .status-item .value { font-weight: 800; }
    #matchLog {
      background: linear-gradient(to bottom, #FFF3A0 0%, #FFD24D 50%, #FFB300 100%);
      color: #5A4100;
      text-shadow: 0 1px 0 rgba(255,255,255,0.6);
      border: 1px solid #D19500;
      border-bottom-color: #9C6E00;
      border-radius: 12px;
      padding: 12px;
      height: 120px;
      overflow-y: auto;
      margin: 10px auto;
      width: 300px;
      text-align: left;
      white-space: pre-wrap;
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.9),
        inset 0 -2px 0 rgba(0,0,0,0.06),
        0 6px 0 #C58A00,
        0 8px 16px rgba(0,0,0,0.15);
    }
    
    /* éœ‡ãˆã‚‹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }
      20%, 40%, 60%, 80% { transform: translateX(2px); }
    }
    
    /* ã‚¿ã‚¤ãƒˆãƒ«ç”»åƒã®ã‚­ãƒ©ãƒƒã¨å…‰ã‚‹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
    @keyframes shineSweep {
      0% { left: -120%; }
      20% { left: -120%; }
      60% { left: 120%; }
      100% { left: 120%; }
    }

    .shake {
      animation: shake 0.5s ease-in-out;
    }
    
    /* å‹åˆ©æ™‚ã®éœ‡ãˆã‚‹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆã‚ˆã‚Šæ¿€ã—ãï¼‰ */
    @keyframes victoryShake {
      0%, 100% { transform: translateX(0) scale(1); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px) scale(1.1); }
      20%, 40%, 60%, 80% { transform: translateX(5px) scale(1.1); }
    }
    
    .victory-shake {
      animation: victoryShake 1s ease-in-out;
      display: inline-block;
    }
    
    /* æ•—åŒ—æ™‚ã®éœ‡ãˆã‚‹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆã‚ˆã‚Šã‚†ã£ãã‚Šï¼‰ */
    @keyframes defeatShake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }
      20%, 40%, 60%, 80% { transform: translateX(2px); }
    }
    
    .defeat-shake {
      animation: defeatShake 1.2s ease-in-out;
      display: inline-block;
    }

    /* èŠ±ã³ã‚‰ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
    .confetti-container {
      position: relative;
      display: inline-block;
      overflow: visible;
    }

    .confetti {
      position: absolute;
      width: 14px;
      height: 14px;
      background: linear-gradient(45deg, #FFD700, #FFA500, #FFD700, #FFA500, #FFD700);
      border-radius: 3px;
      animation: petal-fall 4s ease-in-out infinite;
      box-shadow: 0 0 6px rgba(255, 215, 0, 0.8);
      z-index: 1000;
      pointer-events: none;
    }
    
    /* ç´™å¹é›ªã®è‰²ã®ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ */
    .confetti-1, .confetti-3, .confetti-5, .confetti-7, .confetti-9 {
      background: linear-gradient(45deg, #FFD700, #FFA500, #FFD700, #FFA500, #FFD700);
    }
    
    .confetti-2, .confetti-4, .confetti-6, .confetti-8, .confetti-10 {
      background: linear-gradient(45deg, #FFA500, #FFD700, #FFA500, #FFD700, #FFA500);
    }

    .confetti-1 { 
      left: 10%; 
      top: -20px;
      animation-delay: 0s; 
      animation-duration: 4.2s;
      transform: rotate(45deg);
    }
    .confetti-2 { 
      left: 20%; 
      top: -20px;
      animation-delay: 0.8s; 
      animation-duration: 3.8s;
      transform: rotate(135deg);
    }
    .confetti-3 { 
      left: 30%; 
      top: -20px;
      animation-delay: 1.6s; 
      animation-duration: 4.5s;
      transform: rotate(225deg);
    }
    .confetti-4 { 
      left: 40%; 
      top: -20px;
      animation-delay: 2.4s; 
      animation-duration: 3.9s;
      transform: rotate(315deg);
    }
    .confetti-5 { 
      left: 50%; 
      top: -20px;
      animation-delay: 3.2s; 
      animation-duration: 4.1s;
      transform: rotate(45deg);
    }
    .confetti-6 { 
      left: 60%; 
      top: -20px;
      animation-delay: 0.4s; 
      animation-duration: 4.3s;
      transform: rotate(135deg);
    }
    .confetti-7 { 
      left: 70%; 
      top: -20px;
      animation-delay: 1.2s; 
      animation-duration: 3.7s;
      transform: rotate(225deg);
    }
    .confetti-8 { 
      left: 80%; 
      top: -20px;
      animation-delay: 2.0s; 
      animation-duration: 4.4s;
      transform: rotate(315deg);
    }
    .confetti-9 { 
      left: 15%; 
      top: -20px;
      animation-delay: 2.8s; 
      animation-duration: 3.6s;
      transform: rotate(45deg);
    }
    .confetti-10 { 
      left: 85%; 
      top: -20px;
      animation-delay: 3.6s; 
      animation-duration: 4.0s;
      transform: rotate(135deg);
    }

    @keyframes petal-fall {
      0% {
        transform: translateY(0px) translateX(0px) rotate(0deg);
        opacity: 1;
      }
      25% {
        transform: translateY(60px) translateX(15px) rotate(90deg);
        opacity: 0.9;
      }
      50% {
        transform: translateY(120px) translateX(-10px) rotate(180deg);
        opacity: 0.8;
      }
      75% {
        transform: translateY(180px) translateX(20px) rotate(270deg);
        opacity: 0.6;
      }
      100% {
        transform: translateY(240px) translateX(-15px) rotate(360deg);
        opacity: 0;
      }
    }

    /* åå‰å…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ« */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal-overlay.active { display: flex; }
    .modal-dialog {
      background: #ffffff;
      border-radius: 12px;
      padding: 20px;
      width: 90%;
      max-width: 360px;
      box-shadow: 0 10px 24px rgba(0,0,0,0.25);
      text-align: left;
    }
    .modal-dialog h3 { margin: 0 0 12px; color: #333; }
    .modal-dialog input[type="text"] {
      width: 100%;
      padding: 10px 12px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      outline: none;
      box-sizing: border-box;
    }
    .modal-actions { display: flex; gap: 12px; justify-content: flex-end; margin-top: 14px; }
    .modal-actions .primary {
      background: linear-gradient(to bottom, #FFF3A0 0%, #FFD24D 50%, #FFB300 100%);
      color: #5A4100;
      text-shadow: 0 1px 0 rgba(255,255,255,0.7);
      border: 1px solid #D19500;
      border-bottom-color: #9C6E00;
      border-radius: 10px;
      padding: 10px 18px;
      font-weight: 700;
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.9),
        inset 0 -2px 0 rgba(0,0,0,0.06),
        0 6px 0 #C58A00,
        0 8px 16px rgba(0,0,0,0.15);
    }
    .modal-actions .secondary {
      background: #e9e9e9;
      color: #333;
      border: 1px solid #cfcfcf;
      border-radius: 10px;
      padding: 10px 18px;
      font-weight: 700;
    }
  </style>
</head>
<body>

  <!-- ãƒ›ãƒ¼ãƒ ç”»é¢ -->
  <div id="home" class="screen active">
    <div class="title-image-wrap">
      <img src="titleimage-02.png" alt="ãƒãƒ¬ãƒ¼ãƒœãƒ¼ãƒ«é¸æ‰‹è‚²æˆã‚²ãƒ¼ãƒ " class="title-image" />
    </div>
    <button onclick="openNameModal()">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
  </div>

  <!-- åå‰å…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="nameModal" class="modal-overlay" aria-hidden="true">
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="nameModalTitle">
      <h3 id="nameModalTitle">åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h3>
      <input id="nameInput" type="text" maxlength="20" placeholder="ãŸã‹ã—" />
      <div class="modal-actions">
        <button type="button" class="secondary" onclick="closeNameModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button type="button" class="primary" onclick="confirmName()">OK</button>
      </div>
    </div>
  </div>

  <!-- è‚²æˆç”»é¢ -->
  <div id="training" class="screen">
    <h2>è‚²æˆç”»é¢</h2>
    <div class="layout training-layout">
      <div class="status-col">
        <div class="status-block">
          <ul class="status-list">
            <li class="status-item"><span class="label">åå‰</span><span class="value" id="playerName">ãŸã‹ã—</span></li>
            <li class="status-item" id="powerContainer"><span class="label">ç­‹åŠ›</span><span class="value" id="power">10</span></li>
            <li class="status-item" id="techContainer"><span class="label">ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯</span><span class="value" id="tech">10</span></li>
            <li class="status-item"><span class="label">ç¬¬</span><span class="value" id="week">1</span><span class="label">é€±ç›®</span></li>
          </ul>
        </div>
        <div class="actions-block">
          <button onclick="train('power')">ç­‹ãƒˆãƒ¬ã™ã‚‹</button>
          <button onclick="train('tech')">æŠ€è¡“ç·´ç¿’ã™ã‚‹</button>
          <br />
          <button onclick="nextWeek()">æ¬¡ã®é€±ã¸</button>
        </div>
      </div>
      <div class="image-col">
        <img src="rensyuu.png" alt="ç·´ç¿’å ´" style="max-width: 100%; height: auto; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);" />
      </div>
    </div>
  </div>

  <!-- è©¦åˆã‚¤ãƒ™ãƒ³ãƒˆç”»é¢ -->
  <div id="match" class="screen">
    <h2 id="matchTitle">è©¦åˆã‚¤ãƒ™ãƒ³ãƒˆ</h2>
    <div class="layout match-layout">
      <div class="content-col">
        <div id="matchLog"></div>
        <button id="matchNextBtn" onclick="playMatchStep()" disabled>è©¦åˆé–‹å§‹</button>
      </div>
      <div class="image-col">
        <img src="game.png" alt="è©¦åˆå ´" style="max-width: 100%; height: auto; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);" />
      </div>
    </div>
  </div>

    <!-- ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ -->
  <div id="ending" class="screen">
    <h2 style="
      background: linear-gradient(to bottom, #FFF3A0 0%, #FFD24D 50%, #FFB300 100%);
      color: #5A4100;
      text-shadow: 0 1px 0 rgba(255,255,255,0.7);
      border: 1px solid #D19500;
      border-bottom-color: #9C6E00;
      border-radius: 12px;
      padding: 10px 16px;
      font-weight: 700;
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.9),
        inset 0 -2px 0 rgba(0,0,0,0.06),
        0 6px 0 #C58A00,
        0 8px 16px rgba(0,0,0,0.25);
      margin: 0 auto 20px;
      text-align: center;
      display: inline-block;
    ">ğŸ† å…¨å›½å¤§ä¼šå„ªå‹ï¼ğŸ†</h2>
    <div class="layout match-layout">
      <div class="content-col">
        <div class="status-block">
          <div style="
            background: linear-gradient(to bottom, #FFF3A0 0%, #FFD24D 50%, #FFB300 100%);
            color: #5A4100;
            text-shadow: 0 1px 0 rgba(255,255,255,0.7);
            border: 1px solid #D19500;
            border-bottom-color: #9C6E00;
            border-radius: 12px;
            padding: 16px 20px;
            font-weight: 700;
            box-shadow:
              inset 0 1px 0 rgba(255,255,255,0.9),
              inset 0 -2px 0 rgba(0,0,0,0.06),
              0 6px 0 #C58A00,
              0 8px 16px rgba(0,0,0,0.25);
            margin: 0 auto 20px;
            text-align: center;
            display: inline-block;
          ">
            <h3 style="margin: 0 0 12px 0; font-size: 1.3rem;">è¡¨å½°å¼</h3>
            <p style="margin: 8px 0; font-size: 1.1rem;">ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼</p>
            <p style="margin: 8px 0; font-size: 1.1rem;">ã‚ãªãŸã¯å…¨å›½å¤§ä¼šã‚’åˆ¶è¦‡ã—ã€</p>
            <p style="margin: 8px 0; font-size: 1.1rem;">ãƒãƒ¬ãƒ¼ãƒœãƒ¼ãƒ«ç•Œã®é ‚ç‚¹ã«ç«‹ã¡ã¾ã—ãŸï¼</p>
          </div>
          <br />
          <div class="status-list" style="margin: 20px auto;">
            <div class="status-item" style="
              background: linear-gradient(to bottom, #FFF3A0 0%, #FFD24D 50%, #FFB300 100%);
              color: #5A4100;
              text-shadow: 0 1px 0 rgba(255,255,255,0.7);
              border: 1px solid #D19500;
              border-bottom-color: #9C6E00;
              border-radius: 12px;
              padding: 12px 18px;
              font-weight: 700;
              box-shadow:
                inset 0 1px 0 rgba(255,255,255,0.9),
                inset 0 -2px 0 rgba(0,0,0,0.06),
                0 6px 0 #C58A00,
                0 8px 16px rgba(0,0,0,0.22);
              margin: 8px 0;
              display: inline-flex;
              align-items: baseline;
              gap: 8px;
            ">
              <span class="label">ç­‹åŠ›</span>
              <span class="value" id="finalPower">0</span>
            </div>
            <div class="status-item" style="
              background: linear-gradient(to bottom, #FFF3A0 0%, #FFD24D 50%, #FFB300 100%);
              color: #5A4100;
              text-shadow: 0 1px 0 rgba(255,255,255,0.7);
              border: 1px solid #D19500;
              border-bottom-color: #9C6E00;
              border-radius: 12px;
              padding: 12px 18px;
              font-weight: 700;
              box-shadow:
                inset 0 1px 0 rgba(255,255,255,0.9),
                inset 0 -2px 0 rgba(0,0,0,0.06),
                0 6px 0 #C58A00,
                0 8px 16px rgba(0,0,0,0.22);
              margin: 8px 0;
              display: inline-flex;
              align-items: baseline;
              gap: 8px;
            ">
              <span class="label">ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯</span>
              <span class="value" id="finalTech">0</span>
            </div>
            <div class="status-item" style="
              background: linear-gradient(to bottom, #FFF3A0 0%, #FFD24D 50%, #FFB300 100%);
              color: #5A4100;
              text-shadow: 0 1px 0 rgba(255,255,255,0.7);
              border: 1px solid #D19500;
              border-bottom-color: #9C6E00;
              border-radius: 12px;
              padding: 12px 18px;
              font-weight: 700;
              box-shadow:
                inset 0 1px 0 rgba(255,255,255,0.9),
                inset 0 -2px 0 rgba(0,0,0,0.06),
                0 6px 0 #C58A00,
                0 8px 16px rgba(0,0,0,0.22);
              margin: 8px 0;
              display: inline-flex;
              align-items: baseline;
              gap: 8px;
            ">
              <span class="label">ç·åˆèƒ½åŠ›</span>
              <span class="value" id="finalTotal">0</span>
            </div>
          </div>
          <br />
          <button onclick="restartGame()" id="restartBtn" style="
            background: linear-gradient(to bottom, #FFF3A0 0%, #FFD24D 50%, #FFB300 100%);
            color: #5A4100;
            text-shadow: 0 1px 0 rgba(255,255,255,0.7);
            border: 1px solid #D19500;
            border-bottom-color: #9C6E00;
            border-radius: 12px;
            padding: 12px 24px;
            font-weight: 700;
            box-shadow:
              inset 0 1px 0 rgba(255,255,255,0.9),
              inset 0 -2px 0 rgba(0,0,0,0.06),
              0 6px 0 #C58A00,
              0 8px 16px rgba(0,0,0,0.25);
            transform: translateY(0);
            transition: transform 0.1s ease, box-shadow 0.1s ease, filter 0.2s ease;
            margin: 20px 0;
            cursor: pointer;
          ">ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
        </div>
      </div>
      <div class="image-col">
        <div class="confetti-container">
          <img src="ending.png" alt="ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°" style="max-width: 100%; height: auto; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);" />
          <!-- ç´™å¹é›ªã®è¦ç´ ã‚’ç”»åƒã®ä¸Šã«é‡ã­ã¦é…ç½® -->
          <div class="confetti confetti-1"></div>
          <div class="confetti confetti-2"></div>
          <div class="confetti confetti-3"></div>
          <div class="confetti confetti-4"></div>
          <div class="confetti confetti-5"></div>
          <div class="confetti confetti-6"></div>
          <div class="confetti confetti-7"></div>
          <div class="confetti confetti-8"></div>
          <div class="confetti confetti-9"></div>
          <div class="confetti confetti-10"></div>
        </div>
      </div>
    </div>
  </div>

<script>
  // ãƒšãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã¯å¸¸ã«æœ€ä¸Šéƒ¨ã‚’è¡¨ç¤º
  if ('scrollRestoration' in window.history) {
    window.history.scrollRestoration = 'manual';
  }
  const forceScrollToTop = () => {
    window.scrollTo(0, 0);
  };
  document.addEventListener('DOMContentLoaded', forceScrollToTop);
  window.addEventListener('load', forceScrollToTop);
  window.addEventListener('pageshow', (event) => {
    if (event.persisted) forceScrollToTop();
  });

  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿
  let player = {
    name: "ãŸã‹ã—",
    power: 10,
    tech: 10,
    week: 1
  };

  // å¤§ä¼šãƒ‡ãƒ¼ã‚¿
  let tournament = {
    stage: 0, // 0: å¤§ä¼šæœªé–‹å§‹, 1~7: è©¦åˆã‚¹ãƒ†ãƒ¼ã‚¸
    maxStage: 7,
    active: false,
  };

  // è©¦åˆãƒ­ã‚°å€™è£œ
  const matchLogs = [
    "ã‚¹ãƒ‘ã‚¤ã‚¯ã‚’æ±ºã‚ãŸï¼",
    "ã‚µãƒ¼ãƒ–ã‚’æ±ºã‚ãŸï¼",
    "ãƒ¬ã‚·ãƒ¼ãƒ–ã‚’æ‰“ã¡è¿”ã—ãŸï¼",
    "ãƒˆã‚¹ãŒãã‚Œã„ã«ä¸ŠãŒã£ãŸï¼",
    "ãƒ•ã‚§ã‚¤ãƒ³ãƒˆãŒæ±ºã¾ã£ãŸï¼",
    "ãƒ–ãƒ­ãƒƒã‚¯ã§å¾—ç‚¹ï¼"
  ];

  // è©¦åˆãƒ­ã‚°ã®è¡¨ç¤ºé–“éš”ï¼ˆãƒŸãƒªç§’ï¼‰
  const MATCH_LOG_DELAY_MS = 1200;

  // ãƒ­ã‚°è¡¨ç¤ºç”¨ã‚­ãƒ¥ãƒ¼ã¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
  let logQueue = [];
  let currentLogIndex = 0;
  let matchResult = null;

  function startGame() {
    switchScreen("home", "training");
    updateStatus();
  }

  // åå‰å…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ«
  function openNameModal() {
    const overlay = document.getElementById('nameModal');
    overlay.classList.add('active');
    const input = document.getElementById('nameInput');
    input.value = player.name || '';
    setTimeout(() => input.focus(), 0);
  }

  function closeNameModal() {
    const overlay = document.getElementById('nameModal');
    overlay.classList.remove('active');
  }

  function confirmName() {
    const value = document.getElementById('nameInput').value.trim();
    if (value) {
      player.name = value;
      const nameSpan = document.getElementById('playerName');
      if (nameSpan) nameSpan.textContent = player.name;
    }
    closeNameModal();
    startGame();
  }

  function switchScreen(from, to) {
    document.getElementById(from).classList.remove("active");
    document.getElementById(to).classList.add("active");
    if (to === "home") {
      forceScrollToTop();
    }
  }

  function updateStatus() {
    document.getElementById("power").textContent = player.power;
    document.getElementById("tech").textContent = player.tech;
    document.getElementById("week").textContent = player.week;
  }

  function train(type) {
    player[type] += 1;
    updateStatus();
    
    // éœ‡ãˆã‚‹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ 
    const containerId = type === 'power' ? 'powerContainer' : 'techContainer';
    const container = document.getElementById(containerId);
    container.classList.add('shake');
    
    // ã‚¨ãƒ•ã‚§ã‚¯ãƒˆçµ‚äº†å¾Œã«ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
    setTimeout(() => {
      container.classList.remove('shake');
    }, 500);
  }

  function nextWeek() {
    player.week++;
    if (!checkForMatch()) {
      alert(`ç¬¬${player.week}é€±ç›®ã¸é€²ã¿ã¾ã™`);
    }
  }

  // å¤§ä¼šé–‹å§‹åˆ¤å®šã¨å¤§ä¼šä¸­ãªã‚‰è©¦åˆè¡¨ç¤º
  function checkForMatch() {
    const total = player.power + player.tech;
    if (total >= 30 && tournament.stage === 0) {
      tournament.stage = 1;
      tournament.active = true;
      showMatch();
      return true;
    }
    if (tournament.active && tournament.stage > 0 && tournament.stage <= tournament.maxStage) {
      showMatch();
      return true;
    }
    return false;
  }

  function showMatch() {
    const titles = [
      "",
      "åœ°æ–¹å¤§ä¼šãƒ»äºˆé¸",
      "åœ°æ–¹å¤§ä¼šãƒ»æº–æ±ºå‹",
      "åœ°æ–¹å¤§ä¼šãƒ»æ±ºå‹",
      "å…¨å›½å¤§ä¼šå‡ºå ´æ±ºå®šï¼",
      "å…¨å›½å¤§ä¼šãƒ»äºˆé¸",
      "å…¨å›½å¤§ä¼šãƒ»æº–æ±ºå‹",
      "å…¨å›½å¤§ä¼šãƒ»æ±ºå‹",
    ];
    document.getElementById("matchTitle").textContent = titles[tournament.stage];
    document.getElementById("matchLog").textContent = "";
    document.getElementById("matchNextBtn").disabled = false;
    
    // ãƒ­ã‚°è¡¨ç¤ºã®çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
    currentLogIndex = 0;
    logQueue = [];
    matchResult = null;
    
    switchScreen("training", "match");
  }

  function prepareMatchLogs() {
    const shuffled = [...matchLogs].sort(() => 0.5 - Math.random());
    logQueue = shuffled.slice(0, 3);
    currentLogIndex = 0;

    // å‹ç‡ã‚’1/2ï¼ˆ50%ï¼‰ã«å›ºå®š
    const result = Math.random();
    matchResult = result <= 0.5;
  }

  function playMatchStep() {
    // è©¦åˆé–‹å§‹ã‚’æŠ¼ã—ãŸã‚‰ãƒ­ã‚°â†’çµæœã®é †ã§è‡ªå‹•å†ç”Ÿ
    if (currentLogIndex === 0) {
      prepareMatchLogs();
      // ãƒ­ã‚°ã‚¨ãƒªã‚¢ã‚’ã‚¯ãƒªã‚¢
      const logArea = document.getElementById("matchLog");
      logArea.textContent = "";
    }
    
    const logArea = document.getElementById("matchLog");
    const nextBtn = document.getElementById("matchNextBtn");
    nextBtn.disabled = true;

    const showNext = () => {
      if (currentLogIndex < logQueue.length) {
        const logSpan = document.createElement('span');
        logSpan.textContent = logQueue[currentLogIndex] + "\n";
        logArea.appendChild(logSpan);
        logArea.scrollTop = logArea.scrollHeight;
        currentLogIndex++;
        setTimeout(showNext, MATCH_LOG_DELAY_MS); // ãƒ­ã‚°ã‚’é †ã«è¡¨ç¤º
        return;
      }

      // ãƒ­ã‚°ã‚’ã™ã¹ã¦è¡¨ç¤ºã—ãŸå¾Œã«çµæœã‚’è¡¨ç¤ºï¼ˆå°‘ã—é…å»¶ã‚’å…¥ã‚Œã¦ç¢ºå®Ÿã«è¡¨ç¤ºï¼‰
      setTimeout(() => {
        if (matchResult) {
          const winMessage = "\nå‹åˆ©ï¼ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’é€²ã‚ã¾ã™ï¼";
          const winSpan = document.createElement('span');
          winSpan.style.color = 'red';
          winSpan.style.fontWeight = 'bold';
          winSpan.style.display = 'inline-block';
          winSpan.textContent = winMessage;
          logArea.appendChild(winSpan);
          setTimeout(() => { winSpan.classList.add('victory-shake'); }, 10);

          player.power += 2;
          player.tech += 2;
          tournament.stage++;
          if (tournament.stage > tournament.maxStage) {
            const endingMessage = "\nå…¨å›½å¤§ä¼šã‚’åˆ¶è¦‡ã—ã¾ã—ãŸï¼è¡¨å½°å¼ã¸ï¼";
            const endingSpan = document.createElement('span');
            endingSpan.style.color = 'red';
            endingSpan.style.fontWeight = 'bold';
            endingSpan.style.display = 'inline-block';
            endingSpan.textContent = endingMessage;
            logArea.appendChild(endingSpan);
            setTimeout(() => { endingSpan.classList.add('victory-shake'); }, 10);
            tournament.active = false;
            setTimeout(() => { showEnding(); }, 3000);
          }
        } else {
          const loseMessage = "\næ•—åŒ—â€¦åœ°æ–¹å¤§ä¼šã‹ã‚‰ã‚„ã‚Šç›´ã—ã§ã™ã€‚";
          const loseSpan = document.createElement('span');
          loseSpan.style.color = 'blue';
          loseSpan.style.fontWeight = 'bold';
          loseSpan.style.display = 'inline-block';
          loseSpan.textContent = loseMessage;
          logArea.appendChild(loseSpan);
          setTimeout(() => { loseSpan.classList.add('defeat-shake'); }, 10);
          tournament.stage = 1;
          tournament.active = true;
        }

        updateStatus();
        setTimeout(() => { switchScreen("match", "training"); }, 2000);
      }, 500); // ãƒ­ã‚°è¡¨ç¤ºå®Œäº†å¾Œã€500mså¾…ã£ã¦ã‹ã‚‰çµæœã‚’è¡¨ç¤º
    };

    showNext();
  }

  function showEnding() {
    // æœ€çµ‚æˆç¸¾ã‚’è¡¨ç¤º
    document.getElementById("finalPower").textContent = player.power;
    document.getElementById("finalTech").textContent = player.tech;
    document.getElementById("finalTotal").textContent = player.power + player.tech;
    
    // ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã«é·ç§»
    switchScreen("match", "ending");
  }

  function restartGame() {
    // ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ
    player = {
      name: "ãŸã‹ã—",
      power: 10,
      tech: 10,
      week: 1
    };
    
    tournament = {
      stage: 0,
      maxStage: 7,
      active: false,
    };
    
    // ãƒ›ãƒ¼ãƒ ç”»é¢ã«æˆ»ã‚‹
    switchScreen("ending", "home");
  }


</script>

</body>
</html>
